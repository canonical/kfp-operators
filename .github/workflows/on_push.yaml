name: On Push

# On push to main or track/** branch, we:
# * always publish to Charmhub at latest/edge/PR-<number>
# * always run tests

on:
  push:
    branches:
    - main
    - track/**


jobs:
  tests:
    name: Run Tests
    uses: ./.github/workflows/_ci.yaml

  # publish runs in series with tests, and only publishes if tests passes
  publish:
    name: Publish
    needs: tests
    uses: canonical/charmed-kubeflow-workflows/.github/workflows/_publish.yaml@all
    secrets: inherit
