name: Publish

on:
  push:
    branches:
      - master
      - update-publishing-workflow # TODO: Remove this after debugging

# TODO: Set the charm matrix from listing /charms folders

jobs:
  publish-charm:
    name: Publish Charm
    runs-on: ubuntu-latest
    strategy:
      matrix:
        charm:
          - kfp-api
          - kfp-persistence
          - kfp-profile-controller
          - kfp-schedwf
          - kfp-ui
          - kfp-viewer
          - kfp-viz
    steps:
    - uses: actions/checkout@v2
    - uses: canonical/charmhub-upload-action@initial-implementation
      with:
        credentials: ${{ secrets.CHARMSTORE_CREDENTIAL }}
        charm-path: charms/{{ matrix.charm }}
        charmcraft-channel: latest/candidate
